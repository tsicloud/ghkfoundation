<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>QR Code Generator</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    // Try multiple CDNs to load the QRCode library
    window.__qrLoaded = false;
    async function loadQRCodeLib() {
      const sources = [
        "https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js",
        "https://unpkg.com/qrcode@1.5.3/build/qrcode.min.js",
        "https://fastly.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"
      ];
      for (const src of sources) {
        try {
          await new Promise((resolve, reject) => {
            const s = document.createElement('script');
            s.src = src;
            s.onload = () => resolve();
            s.onerror = () => reject(new Error('Failed: ' + src));
            document.head.appendChild(s);
          });
          if (window.QRCode) {
            window.__qrLoaded = true;
            return true;
          }
        } catch (e) { /* try next */ }
      }
      return false;
    }
  </script>
</head>
<body class="min-h-screen bg-gray-50 text-gray-900">
  <div class="max-w-3xl mx-auto p-6">
    <header class="mb-6">
      <h1 class="text-3xl font-bold tracking-tight">QR Code Generator</h1>
      <p class="text-gray-600 mt-1">Type any text or URL, tweak options, and download as PNG or SVG.</p>
    </header>

    <section class="bg-white border rounded-xl shadow-sm p-5">
      <div class="grid sm:grid-cols-2 gap-6">
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium mb-1" for="qrText">Text / URL</label>
            <textarea id="qrText" class="w-full rounded-md border-gray-300 focus:ring-2 focus:ring-blue-500 focus:outline-none p-2" rows="4" placeholder="https://example.com"></textarea>
          </div>

          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium mb-1" for="size">Size (px)</label>
              <input id="size" type="number" min="64" step="8" value="256" class="w-full rounded-md border-gray-300 focus:ring-2 focus:ring-blue-500 p-2">
            </div>
            <div>
              <label class="block text-sm font-medium mb-1" for="margin">Margin (modules)</label>
              <input id="margin" type="number" min="0" max="16" value="4" class="w-full rounded-md border-gray-300 focus:ring-2 focus:ring-blue-500 p-2">
            </div>
          </div>

          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium mb-1" for="ecc">Error Correction</label>
              <select id="ecc" class="w-full rounded-md border-gray-300 focus:ring-2 focus:ring-blue-500 p-2">
                <option value="L">L (Low ~7%)</option>
                <option value="M" selected>M (Medium ~15%)</option>
                <option value="Q">Q (Quartile ~25%)</option>
                <option value="H">H (High ~30%)</option>
              </select>
            </div>
            <div class="grid grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium mb-1" for="darkColor">QR Color</label>
                <input id="darkColor" type="color" value="#000000" class="w-full h-10 rounded-md border-gray-300 p-1">
              </div>
              <div>
                <label class="block text-sm font-medium mb-1" for="lightColor">Background</label>
                <input id="lightColor" type="color" value="#ffffff" class="w-full h-10 rounded-md border-gray-300 p-1">
              </div>
            </div>
          </div>

          <div class="flex flex-wrap gap-3 pt-2">
            <button id="generateBtn" class="px-4 py-2 rounded-md bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50">Generate</button>
            <button id="downloadPngBtn" class="px-4 py-2 rounded-md bg-gray-800 text-white hover:bg-gray-900 disabled:opacity-50">Download PNG</button>
            <button id="downloadSvgBtn" class="px-4 py-2 rounded-md bg-gray-200 hover:bg-gray-300 disabled:opacity-50">Download SVG</button>
            <button id="clearBtn" class="px-4 py-2 rounded-md bg-white border hover:bg-gray-50">Clear</button>
          </div>
          <p class="text-xs text-gray-500">Tip: Use higher error correction (Q/H) if you’ll add a logo on top or expect the code to get slightly damaged.</p>
        </div>

        <div class="flex flex-col items-center justify-center">
          <div id="previewWrap" class="bg-white border rounded-lg p-4 shadow-sm">
            <canvas id="qrCanvas" width="256" height="256" class="block"></canvas>
          </div>
          <p id="status" class="text-sm text-gray-500 mt-3">Loading libraries…</p>
        </div>
      </div>
    </section>

    <footer class="mt-8 text-xs text-gray-500">
      <p>Built with <code>qrcode</code> JS library. No data is sent anywhere; it all runs in your browser.</p>
    </footer>
  </div>

<script>
  const textarea = document.getElementById('qrText');
  const sizeInput = document.getElementById('size');
  const marginInput = document.getElementById('margin');
  const eccSelect = document.getElementById('ecc');
  const darkColorInput = document.getElementById('darkColor');
  const lightColorInput = document.getElementById('lightColor');
  const canvas = document.getElementById('qrCanvas');
  const statusEl = document.getElementById('status');

  const genBtn = document.getElementById('generateBtn');
  const pngBtn = document.getElementById('downloadPngBtn');
  const svgBtn = document.getElementById('downloadSvgBtn');
  const clearBtn = document.getElementById('clearBtn');

  function setStatus(msg) {
    statusEl.textContent = msg;
  }

  function enableDownloads(enable) {
    pngBtn.disabled = !enable;
    svgBtn.disabled = !enable;
  }

  async function ensureLib() {
    if (window.__qrLoaded && window.QRCode) return true;
    setStatus('Loading QR library…');
    const ok = await loadQRCodeLib();
    if (!ok) {
      setStatus('Failed to load QR library. Open in a full browser or check your connection.');
      return false;
    }
    setStatus('Ready.');
    return true;
  }

  async function generateQR() {
    if (!(await ensureLib())) return;
    const text = textarea.value.trim();
    if (!text) {
      setStatus('Enter some text or a URL to generate a QR code.');
      enableDownloads(false);
      const ctx = canvas.getContext('2d');
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      return;
    }

    const size = Math.max(64, parseInt(sizeInput.value || '256', 10));
    const margin = Math.max(0, parseInt(marginInput.value || '4', 10));
    const ecc = eccSelect.value;
    const dark = darkColorInput.value || '#000000';
    const light = lightColorInput.value || '#ffffff';

    // Resize canvas to requested size
    canvas.width = size;
    canvas.height = size;

    setStatus('Generating…');
    window.QRCode.toCanvas(
      canvas,
      text,
      {
        width: size,
        margin: margin,
        errorCorrectionLevel: ecc,
        color: {
          dark: dark,
          light: light
        }
      },
      function (err) {
        if (err) {
          console.error(err);
          setStatus('Error: ' + err.message);
          enableDownloads(false);
        } else {
          setStatus('Done. You can download as PNG or SVG.');
          enableDownloads(true);
        }
      }
    );
  }

  function downloadPng() {
    const link = document.createElement('a');
    link.download = 'qr.png';
    link.href = canvas.toDataURL('image/png');
    link.click();
  }

  async function downloadSvg() {
    if (!(await ensureLib())) return;
    const text = textarea.value.trim();
    if (!text) return;

    try {
      const size = Math.max(64, parseInt(sizeInput.value || '256', 10));
      const margin = Math.max(0, parseInt(marginInput.value || '4', 10));
      const ecc = eccSelect.value;
      const dark = darkColorInput.value || '#000000';
      const light = lightColorInput.value || '#ffffff';

      const svgString = await window.QRCode.toString(text, {
        type: 'svg',
        width: size,
        margin: margin,
        errorCorrectionLevel: ecc,
        color: { dark, light }
      });
      const blob = new Blob([svgString], { type: 'image/svg+xml' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'qr.svg';
      a.click();
      URL.revokeObjectURL(url);
    } catch (e) {
      console.error(e);
      setStatus('SVG error: ' + e.message);
    }
  }

  function clearAll() {
    textarea.value = '';
    setStatus('Cleared.');
    enableDownloads(false);
    const ctx = canvas.getContext('2d');
    ctx.clearRect(0, 0, canvas.width, canvas.height);
  }

  genBtn.addEventListener('click', generateQR);
  pngBtn.addEventListener('click', downloadPng);
  svgBtn.addEventListener('click', downloadSvg);
  clearBtn.addEventListener('click', clearAll);

  // Auto-load the library and render a starter QR so the canvas isn't empty
  (async () => {
    await ensureLib();
    textarea.value = 'https://example.com';
    await generateQR();
  })();
</script>
</body>
</html>
